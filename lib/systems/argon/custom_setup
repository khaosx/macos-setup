# Set power options - choices are laptop, desktop, or server
source "$BOOTSTRAP_DIR/lib/power_settings/desktop"

# Make user script and dev directories
mkdir $dirAppHome
mkdir -p $HOME/.ssh
mkdir -p $HOME/scripts

# Download components
dirAppHome=$HOME/AppTemp

wget --quiet -O "$dirAppHome/Duplicate Annihilator for Photos.dmg.zip" https://brattoo.com/propaganda/downloadDap.php
wget --quiet -O "$dirAppHome/photosSetLongitudeAndLatitude.zip" https://free.brattoo.com/apps/photosSetLongitudeAndLatitude.zip
wget --quiet -O "$dirAppHome/photodateToFiledate.zip" https://free.brattoo.com/apps/photodateToFiledate.zip
wget --quiet -O "$dirAppHome/MP3 Trimmer.dmg" http://deepniner.net/mp3trimmer/MP3%20Trimmer.dmg
#wget --quiet -O "$dirAppHome/FileBot_4.8.2.pkg" https://get.filebot.net/filebot/FileBot_4.8.5/FileBot_4.8.5.pkg

# Install and cleanup 
for f in $dirAppHome/*.zip
do
	unzip -qq -d $dirAppHome -n "$f"
	rm "$f"
	rm -rf $dirAppHome/__MACOSX
done

for f in $dirAppHome/*.dmg
do
	strFilename=$(basename "$f")
	strDMGName="${strFilename%.*}"
	hdiutil attach -nobrowse "$f"
	if [ -d "/Volumes/$strDMGName/$strDMGName.app" ]; then
		cp -r "/Volumes/$strDMGName/$strDMGName.app" /Applications
	fi
	hdiutil detach "/Volumes/$strDMGName"
	rm "$f"
done

for f in $dirAppHome/*.app
do
	mv "$f" /Applications
done

for f in $dirAppHome/*.pkg
do
	sudo installer -pkg "$f" -target /
	rm "$f"
done

rm -rf $dirAppHome

# Restore from storage drive
if [ -d "/Volumes/Storage/$HOSTNAME/backups" ]; then
	BackupPortable="/Volumes/Storage/$HOSTNAME/backups"
	cp "$BackupPortable"/ssh/* $HOME/.ssh/
	cp -R  "$BackupPortable"/scripts/* /Users/kris/scripts
	rsync -r -v -t "$BackupPortable/MakeMKV/" $HOME/Library/MakeMKV
	rsync -r -v -t "$BackupPortable/Hazel" "$HOME/Library/Application Support/"
	cp "$BackupPortable/com.makemkv.MakeMKV.plist" "$HOME/Library/Preferences/com.makemkv.MakeMKV.plist"
	cp "$BackupPortable/com.noodlesoft.Hazel.plist" "$HOME/Library/Preferences/com.noodlesoft.Hazel.plist"
	cp "$BackupPortable/com.noodlesoft.HazelHelper.plist" "$HOME/Library/Preferences/com.noodlesoft.HazelHelper.plist"
	rm -rf "$BackupPortable"
fi